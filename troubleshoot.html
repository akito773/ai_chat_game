<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨ºæ–­</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .step { background: #f9f9f9; padding: 20px; margin: 15px 0; border-radius: 10px; border-left: 5px solid #007bff; }
        .success { border-left-color: #28a745; background: #d4edda; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .button { display: inline-block; background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; margin: 10px 5px; cursor: pointer; border: none; }
        .button:hover { background: #0056b3; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; margin: 10px 0; }
        .diagnostic-result { margin: 15px 0; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ AIãƒãƒ£ãƒƒãƒˆã‚²ãƒ¼ãƒ  ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h1>
        <p>APIæ¥ç¶šã‚¨ãƒ©ãƒ¼ã®è§£æ±ºæ‰‹é †ã‚’æ¡ˆå†…ã—ã¾ã™ã€‚</p>

        <div class="step">
            <h3>ğŸ“‹ ç¾åœ¨ã®çŠ¶æ³</h3>
            <p>âœ… åŸºæœ¬æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ: æ­£å¸¸</p>
            <p>âŒ APIæ¥ç¶šãƒ†ã‚¹ãƒˆ: Failed to fetch</p>
            <p><strong>è¨ºæ–­:</strong> PHPã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„</p>
        </div>

        <div class="step">
            <h3>ğŸš€ è§£æ±ºæ‰‹é † 1: ã‚µãƒ¼ãƒãƒ¼èµ·å‹•</h3>
            <p><strong>æ¨å¥¨æ–¹æ³•:</strong></p>
            <div class="code">start_server.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯</div>
            <p>ã¾ãŸã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œ:</p>
            <div class="code">
                cd C:\Users\akar0\Desktop\ai_chat_game<br>
                php -S localhost:8000
            </div>
            <button class="button" onclick="checkServerStatus()">ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ã‚’ç¢ºèª</button>
            <div id="serverStatus" class="diagnostic-result"></div>
        </div>

        <div class="step">
            <h3>ğŸ’¡ è§£æ±ºæ‰‹é † 2: PHPãŒç„¡ã„å ´åˆã®å¯¾å‡¦</h3>
            <p>PHPãŒç„¡ã„å ´åˆã¯ã€ä»¥ä¸‹ã®é¸æŠè‚¢ãŒã‚ã‚Šã¾ã™:</p>
            <ol>
                <li><strong>XAMPP ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</strong> (æ¨å¥¨)
                    <ul>
                        <li><a href="https://www.apachefriends.org/" target="_blank">XAMPPå…¬å¼ã‚µã‚¤ãƒˆ</a>ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                        <li>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€XAMPPã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã§Apacheã‚’èµ·å‹•</li>
                        <li>ã‚²ãƒ¼ãƒ ãƒ•ã‚©ãƒ«ãƒ€ã‚’htdocsã«ã‚³ãƒ”ãƒ¼</li>
                    </ul>
                </li>
                <li><strong>ãƒ­ãƒ¼ã‚«ãƒ«å¿œç­”ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨</strong>
                    <div class="code">js/config.js ã§ useAPI: false ã«å¤‰æ›´</div>
                    <p>ã“ã®å ´åˆã€GPT-4o miniã¯ä½¿ãˆã¾ã›ã‚“ãŒã€äºˆã‚ç”¨æ„ã•ã‚ŒãŸå¿œç­”ã§ãƒãƒ£ãƒƒãƒˆã§ãã¾ã™ã€‚</p>
                </li>
            </ol>
        </div>

        <div class="step">
            <h3>ğŸ”§ è§£æ±ºæ‰‹é † 3: ç°¡æ˜“è¨ºæ–­å®Ÿè¡Œ</h3>
            <button class="button" onclick="runDiagnostics()">è‡ªå‹•è¨ºæ–­ã‚’å®Ÿè¡Œ</button>
            <div id="diagnosticsResult" class="diagnostic-result"></div>
        </div>

        <div class="step">
            <h3>ğŸ® è§£æ±ºæ‰‹é † 4: ã™ãã«è©¦ã—ãŸã„å ´åˆ</h3>
            <p>APIç„¡ã—ã§ã‚‚å‹•ä½œã™ã‚‹è¨­å®šã«å¤‰æ›´:</p>
            <button class="button" onclick="enableLocalMode()">ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–</button>
            <p>ãã®å¾Œã€<a href="index.html" class="button">ã‚²ãƒ¼ãƒ é–‹å§‹</a></p>
            <div id="localModeResult" class="diagnostic-result"></div>
        </div>

        <div class="step warning">
            <h3>âš ï¸ ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾å‡¦æ³•</h3>
            <ul>
                <li><strong>ãƒãƒ¼ãƒˆ8000ãŒä½¿ç”¨ä¸­:</strong> start_server.batãŒè‡ªå‹•ã§8001ã‚’ä½¿ç”¨</li>
                <li><strong>ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ–ãƒ­ãƒƒã‚¯:</strong> Windowsãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹å ´åˆã‚ã‚Š</li>
                <li><strong>æ¨©é™ã‚¨ãƒ©ãƒ¼:</strong> ç®¡ç†è€…æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®Ÿè¡Œ</li>
                <li><strong>æ–‡å­—åŒ–ã‘:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ã§æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’UTF-8ã«è¨­å®š</li>
            </ul>
        </div>
    </div>

    <script>
        async function checkServerStatus() {
            const resultDiv = document.getElementById('serverStatus');
            resultDiv.innerHTML = 'ğŸ” ã‚µãƒ¼ãƒãƒ¼çŠ¶æ³ç¢ºèªä¸­...';
            
            try {
                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ
                const response = await fetch('/');
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">âœ… ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ä¸­ï¼ <a href="test.html">APIãƒ†ã‚¹ãƒˆã¸</a></div>';
                } else {
                    resultDiv.innerHTML = '<div class="warning">âš ï¸ ã‚µãƒ¼ãƒãƒ¼ã¯èµ·å‹•ä¸­ã§ã™ãŒã€å¿œç­”ã«å•é¡ŒãŒã‚ã‚Šã¾ã™</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">âŒ ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã¾ã›ã‚“<br>ğŸ’¡ start_server.bat ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦èµ·å‹•ã—ã¦ãã ã•ã„</div>';
            }
        }

        async function runDiagnostics() {
            const resultDiv = document.getElementById('diagnosticsResult');
            resultDiv.innerHTML = 'ğŸ” è¨ºæ–­å®Ÿè¡Œä¸­...';
            
            let diagnostics = 'è‡ªå‹•è¨ºæ–­çµæœ:\n\n';
            
            // 1. åŸºæœ¬æ©Ÿèƒ½ãƒã‚§ãƒƒã‚¯
            try {
                new Date();
                diagnostics += 'âœ… JavaScriptåŸºæœ¬æ©Ÿèƒ½: OK\n';
            } catch (e) {
                diagnostics += 'âŒ JavaScriptåŸºæœ¬æ©Ÿèƒ½: ã‚¨ãƒ©ãƒ¼\n';
            }
            
            // 2. Fetch API ãƒã‚§ãƒƒã‚¯
            if (typeof fetch !== 'undefined') {
                diagnostics += 'âœ… Fetch API: ä½¿ç”¨å¯èƒ½\n';
            } else {
                diagnostics += 'âŒ Fetch API: ä½¿ç”¨ä¸å¯\n';
            }
            
            // 3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒã‚§ãƒƒã‚¯
            try {
                if (typeof window.CONFIG !== 'undefined') {
                    diagnostics += 'âœ… è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿è¾¼ã¿æ¸ˆã¿\n';
                    diagnostics += `   APIä½¿ç”¨: ${window.CONFIG.useAPI ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹'}\n`;
                } else {
                    diagnostics += 'âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼\n';
                }
            } catch (e) {
                diagnostics += 'âŒ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: ã‚¨ãƒ©ãƒ¼\n';
            }
            
            // 4. ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šãƒ†ã‚¹ãƒˆ
            try {
                const response = await fetch('api/chat.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: 'è¨ºæ–­ãƒ†ã‚¹ãƒˆ' })
                });
                diagnostics += 'âœ… APIæ¥ç¶š: æˆåŠŸ\n';
            } catch (error) {
                diagnostics += 'âŒ APIæ¥ç¶š: å¤±æ•— (' + error.message + ')\n';
                diagnostics += 'ğŸ’¡ è§£æ±ºæ³•: start_server.bat ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•\n';
            }
            
            resultDiv.innerHTML = `<div class="code">${diagnostics}</div>`;
        }

        function enableLocalMode() {
            const resultDiv = document.getElementById('localModeResult');
            resultDiv.innerHTML = 'âš™ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰è¨­å®šä¸­...';
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«è¨­å®šã‚’ä¿å­˜ï¼ˆä¸€æ™‚çš„ï¼‰
            try {
                localStorage.setItem('useLocalMode', 'true');
                resultDiv.innerHTML = '<div class="success">âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–å®Œäº†ï¼<br>ğŸ’¡ ã“ã‚Œã§ APIç„¡ã—ã§ã‚‚ãƒãƒ£ãƒƒãƒˆã§ãã¾ã™ã€‚<br><a href="index.html" class="button">ã‚²ãƒ¼ãƒ é–‹å§‹</a></div>';
            } catch (e) {
                resultDiv.innerHTML = '<div class="warning">âš ï¸ è¨­å®šä¿å­˜ã«å¤±æ•—ã€‚æ‰‹å‹•ã§ js/config.js ã® useAPI ã‚’ false ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ç°¡æ˜“è¨ºæ–­
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(runDiagnostics, 1000);
        });
    </script>
</body>
</html>